<!DOCTYPE html>
<html>
<head>
  <title>Supabase Test</title>
</head>
<body>
  <h1>Supabase Demo [1]</h1>
  
  <input id="messageInput" type="text" placeholder="Type a message">
  <button onclick="saveMessage()">Save</button>

  <h2>Messages</h2>
  <ul id="messagesList"></ul>

  <input type="file" id="fileInput">
  <button onclick="uploadFile()">Upload File</button>
  
  <h2>Uploaded Files</h2>
  <ul id="filesList"></ul>


<!-- Load Supabase JS client -->
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  // Step 1: Replace with your own project URL + anon key
  const SUPABASE_URL = "https://qcjeiiyhipmlhmqgjfqu.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjamVpaXloaXBtbGhtcWdqZnF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyMDgwOTcsImV4cCI6MjA3Mjc4NDA5N30.nDw5xPQWqCebdKLdox1w1d_xrMgZtWTgl6eJ9myJD9k";

  // ✅ Don’t overwrite supabase, use a new variable
  const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Save message to Supabase
  async function saveMessage() {
    const input = document.getElementById("messageInput");
    const { data, error } = await client
      .from("messages")
      .insert([{ content: input.value }]);
    
    if (error) {
      console.error(error);
    } else {
      input.value = "";
      loadMessages();
    }
  }

  // Load messages from Supabase
  async function loadMessages() {
    const { data, error } = await client
      .from("messages")
      .select("*")
      .order("created_at", { ascending: false });

    const list = document.getElementById("messagesList");
    list.innerHTML = "";
    data.forEach(msg => {
      const li = document.createElement("li");
      li.textContent = msg.content;
      list.appendChild(li);
    });
  }

  // Upload file to Supabase Storage
async function uploadFile() {
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];
  if (!file) return alert("Please choose a file first!");

  // Store in a folder with timestamp to avoid overwriting
  const filePath = `uploads/${Date.now()}_${file.name}`;

  let { data, error } = await client
    .storage
    .from("uploads") // bucket name
    .upload(filePath, file);

  if (error) {
    console.error("Upload error:", error.message);
    return;
  }

  // Get public URL
  const { data: urlData } = client
    .storage
    .from("uploads")
    .getPublicUrl(filePath);

  console.log("File available at:", urlData.publicUrl);

  // Show file in list
  addFileToList(urlData.publicUrl, file.type);
}

function addFileToList(url, type) {
  const list = document.getElementById("filesList");
  const li = document.createElement("li");

  if (type.startsWith("image/")) {
    const img = document.createElement("img");
    img.src = url;
    img.width = 200;
    li.appendChild(img);
  } else if (type.startsWith("video/")) {
    const vid = document.createElement("video");
    vid.src = url;
    vid.width = 320;
    vid.controls = true;
    li.appendChild(vid);
  } else {
    const link = document.createElement("a");
    link.href = url;
    link.textContent = "Download file";
    li.appendChild(link);
  }

  list.appendChild(li);
}

  // Load messages on page load
  loadMessages();
</script>
</body>
</html>
